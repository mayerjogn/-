SELECT
	CASE WHEN A.SUPP_TP_CD = 'P' THEN '수행기업'
		 WHEN A.SUPP_TP_CD = 'S' THEN '중소기업'
	ELSE '' END AS SUPP_TP_NM,
	F.SUPP_CORP_NM AS CORP_NM,
    SF_COMM_STR_FMT(F.SUPP_BIZ_NO, '@@@-@@-@@@@@') AS BIZ_NO_DISP,
	--trim(TO_CHAR(COALESCE(A.TRAN_AMT,0), '999,999,999,999,999,999,999')) AS TRAN_AMT,
	COALESCE(A.TRAN_AMT,0) AS TRAN_AMT,
	F.SUPP_CEO_NM AS CEO_NM,
	sf_comm_code_nm('BANK', IN_BANK_CD) AS IN_BANK_NM,
	fn_get_acctalign(A.IN_ACCT_NO, A.IN_BANK_CD) AS ACCT_NO,
	A.REGI_REF_NM,
	A.FIND_REF_NM,
	CASE WHEN A.END_GB = '1' THEN '집행완료'
		 WHEN A.END_GB = '9' THEN '반려'
		 WHEN A.END_GB = '2' THEN '처리중'
		 WHEN A.END_GB = '0' THEN '대기'
		 WHEN A.END_GB = '5' THEN '오류'
	ELSE '' END AS END_NM,
	coalesce(A.PROC_STS, '') AS PROC_STS,
	coalesce(E.ERR_MESSAGE, '') AS ERR_MESSAGE,
	CASE WHEN coalesce(F.NEW_SUPP_CORP_YN, 'N') = 'Y' THEN '예'
	ELSE '아니오' END AS NEW_SUPP_CORP_YN,
	A.TRAN_DATE,
	(select  sf_comm_biz_short_nm(biz_cd) from tb_cfms_pay_req where pay_req_no = A.pay_req_no ) as BIZ_NM
   
FROM TB_CFMS_AP_TRADE_DETAIL A
INNER JOIN TB_CFMS_VACCT C ON A.OUT_VACCT_NO = C.VACCT_NO AND A.OUT_BANK_CD = C.BANK_CD
INNER JOIN TB_CFMS_FIRM_INFO D ON C.ORG_CD = D.FIRM_CD AND C.BANK_CD = D.BANK_CD
LEFT JOIN TB_CFMS_FIRM_ERRCD E ON A.PROC_STS = E.ERR_CD AND A.OUT_BANK_CD = E.BANK_CD AND D.VAN_GB = E.VAN_GB 
LEFT JOIN TB_CFMS_PAY_REQ_AMT F ON A.REG_DATE = F.AP_REG_DATE AND A.REG_NUM = F.AP_REG_NUM AND  A.REG_SEQ = F.AP_REG_SEQ
WHERE 1=1
--AND A.REG_DATE = :REG_DATE
--AND A.REG_NUM = :REG_NUM
